
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IPTV Player</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; margin: 0; padding: 0; }
    header { background: #0c3c78; color: white; padding: 1rem; font-size: 1.5rem; text-align: center; }
    .container { padding: 1rem; max-width: 900px; margin: auto; }
    video { width: 100%; height: auto; max-height: 400px; background: black; margin: 1rem 0; }
    .controls { display: flex; flex-direction: column; align-items: center; }
    .controls input, .controls select, .controls button {
      padding: 0.6rem; margin: 0.3rem; font-size: 1rem; width: 90%; max-width: 600px;
    }
    .channel-list { display: flex; flex-wrap: wrap; justify-content: center; margin-top: 1rem; }
    .channel-btn {
      margin: 0.5rem; padding: 0.75rem 1rem; background: white; border: 1px solid #ccc;
      border-radius: 8px; cursor: pointer; min-width: 150px; text-align: center; font-weight: bold;
    }
    .channel-btn:hover { background: #e6f0ff; }
  </style>
</head>
<body>
  <header>JIO TV +</header>
  <div class="container">
    <video id="player" controls autoplay playsinline muted></video>
    <div class="controls">
      <input type="text" id="search" placeholder="Search channels..." oninput="filterChannels()" />
      <select id="playbackRate" onchange="changeSpeed()">
        <option value="0.25">0.25x</option>
        <option value="0.5">0.5x</option>
        <option value="0.75">0.75x</option>
        <option value="1" selected>Normal</option>
        <option value="1.25">1.25x</option>
        <option value="1.5">1.5x</option>
        <option value="1.75">1.75x</option>
        <option value="2">2x</option>
      </select>
      <input type="text" id="playlistUrl" value="https://m3u.ygxworld.in/p/KzNQzhSZQHCN/playlist.m3u" />
      <button onclick="loadPlaylist()">Load Playlist</button>
    </div>
    <div id="channels" class="channel-list"></div>
  </div>

  <script>
    let allChannels = [];
    function loadPlaylist() {
      const rawUrl = document.getElementById('playlistUrl').value.trim();
      const url = '/playlist?url=' + encodeURIComponent(rawUrl);
      fetch(url)
        .then(res => {
          if (!res.ok) throw new Error('Network response was not ok');
          return res.text();
        })
        .then(data => {
          const lines = data.split('\n');
          allChannels = [];
          for (let i = 0; i < lines.length; i++) {
            if (lines[i].startsWith('#EXTINF')) {
              const nameMatch = lines[i].match(/,(.*)$/);
              const name = nameMatch ? nameMatch[1] : 'Unknown';
              const link = lines[i + 1];
              if (link && link.startsWith('http')) {
                allChannels.push({ name, link });
              }
            }
          }
          displayChannels(allChannels);
        })
        .catch(err => {
          alert('Error loading playlist: ' + err.message);
        });
    }

    function displayChannels(channels) {
      const container = document.getElementById('channels');
      container.innerHTML = '';
      if (channels.length === 0) {
        container.innerHTML = '<p>No channels found.</p>';
        return;
      }
      channels.forEach(ch => {
        const btn = document.createElement('div');
        btn.className = 'channel-btn';
        btn.textContent = ch.name;
        btn.onclick = () => {
          const player = document.getElementById('player');
          player.src = ch.link;
          player.play();
        };
        container.appendChild(btn);
      });
    }

    function filterChannels() {
      const term = document.getElementById('search').value.toLowerCase();
      const filtered = allChannels.filter(ch => ch.name.toLowerCase().includes(term));
      displayChannels(filtered);
    }

    function changeSpeed() {
      const speed = document.getElementById('playbackRate').value;
      document.getElementById('player').playbackRate = parseFloat(speed);
    }

    window.onload = loadPlaylist;
  </script>
</body>
</html>
